@page "/Tests"

@using System.Linq;
@using BlazorClient.Model;
@using BlazorGloser.Services;



<h1>Test Lists</h1>
<button class="btn btn-primary" @onclick="ClearAll">Clear</button>

@if (lst == null)
{
    <p><em>Loading ... </em></p>
}
else
{
    <table class="blueTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Score</th>
                <th>Max</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var w in lst)
            {
                <tr>
                    <td>@w.Dt.Date + @w.Dt.TimeOfDay</td>
                    <td>@w.Name</td>
                    <td>@w.Score</td>
                    <td>@w.MaxScore</td>
                </tr>
            }
        </tbody>
    </table>
}

<h5>@strMsg</h5>
@code {

    [Inject]
    private ILocalStorageService Storage { get; set; }

    //private int currentCount = 0;

    private void ClearAll()
    {
        lst.Clear();
        Storage.RemoveItem("_tests_");
    }

    string strMsg;

    private List<Test> lst = new();
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
            return;
        try
        {
            Test[] aTest = await Storage.GetItem<Test[]>("_tests_");
            lst = aTest.ToList();
        }
        catch(Exception e)
        {
            strMsg = e.Message;
        }

        StateHasChanged();

    }



}


